/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var p=Object.defineProperty;var x=Object.getOwnPropertyDescriptor;var M=Object.getOwnPropertyNames;var N=Object.prototype.hasOwnProperty;var k=(s,a)=>{for(var e in a)p(s,e,{get:a[e],enumerable:!0})},I=(s,a,e,n)=>{if(a&&typeof a=="object"||typeof a=="function")for(let i of M(a))!N.call(s,i)&&i!==e&&p(s,i,{get:()=>a[i],enumerable:!(n=x(a,i))||n.enumerable});return s};var $=s=>I(p({},"__esModule",{value:!0}),s);var E={};k(E,{default:()=>o});module.exports=$(E);var t=require("obsidian"),C={imageFolderPath:"Apple Music Covers"},o=class extends t.Plugin{async onload(){await this.loadSettings(),this.addCommand({id:"insert-apple-music-album",name:"Apple Music\u30A2\u30EB\u30D0\u30E0\u60C5\u5831\u3092\u633F\u5165",callback:async()=>{await this.insertAppleMusicAlbumInfo()}}),this.addSettingTab(new u(this.app,this))}async loadSettings(){this.settings=Object.assign({},C,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}async insertAppleMusicAlbumInfo(){let e=await navigator.clipboard.readText(),n=/https?:\/\/music\.apple\.com\/.+\/album\/.+\/(\d+)/,i=e.match(n);if(!i){new t.Notice("\u30AF\u30EA\u30C3\u30D7\u30DC\u30FC\u30C9\u306B\u6709\u52B9\u306AApple Music\u306E\u30A2\u30EB\u30D0\u30E0URL\u304C\u3042\u308A\u307E\u305B\u3093\u3002");return}let A=i[1];try{let h=await(await fetch(`https://itunes.apple.com/lookup?id=${A}&entity=album&country=JP`)).json();if(h.resultCount===0){new t.Notice("\u30A2\u30EB\u30D0\u30E0\u60C5\u5831\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093\u3067\u3057\u305F\u3002");return}let c=h.results[0],m=c.collectionName||"\u30A2\u30EB\u30D0\u30E0\u540D\u304C\u53D6\u5F97\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F",P=c.artistName||"\u30A2\u30FC\u30C6\u30A3\u30B9\u30C8\u540D\u304C\u53D6\u5F97\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F",d=c.artworkUrl100.replace("100x100bb.jpg","600x600bb.jpg"),y=`${m} \u30AB\u30D0\u30FC.jpg`,{vault:r}=this.app;if(d){let F=await(await fetch(d)).arrayBuffer(),v=new Uint8Array(F),l=this.settings.imageFolderPath||"";l=(0,t.normalizePath)(l),r.getAbstractFileByPath(l)||await r.createFolder(l);let w=`${l}/${y}`;await r.createBinary(w,v);let f=this.app.workspace.getActiveFile();if(!f){new t.Notice("\u30A2\u30AF\u30C6\u30A3\u30D6\u306A\u30CE\u30FC\u30C8\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093\u3002");return}let S=r.getAbstractFileByPath(w),T=this.app.metadataCache.fileToLinktext(S,f.path,!1),b=this.getEditor();b&&b.replaceSelection(`${P} - ${m}
![[${T}]]
`),new t.Notice("\u30A2\u30EB\u30D0\u30E0\u60C5\u5831\u3092\u633F\u5165\u3057\u307E\u3057\u305F\u3002")}else new t.Notice("\u30A2\u30EB\u30D0\u30E0\u30AB\u30D0\u30FC\u753B\u50CF\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093\u3067\u3057\u305F\u3002")}catch(g){console.error(g),new t.Notice("\u30A2\u30EB\u30D0\u30E0\u60C5\u5831\u306E\u53D6\u5F97\u4E2D\u306B\u30A8\u30E9\u30FC\u304C\u767A\u751F\u3057\u307E\u3057\u305F\u3002")}}getEditor(){let e=this.app.workspace.getActiveViewOfType(t.MarkdownView);return e?e.editor:null}},u=class extends t.PluginSettingTab{constructor(e,n){super(e,n);this.plugin=n}display(){let{containerEl:e}=this;e.empty(),e.createEl("h2",{text:"Apple Music \u30D7\u30E9\u30B0\u30A4\u30F3\u8A2D\u5B9A"}),new t.Setting(e).setName("\u753B\u50CF\u4FDD\u5B58\u5148\u30D5\u30A9\u30EB\u30C0").setDesc("\u30A2\u30EB\u30D0\u30E0\u30AB\u30D0\u30FC\u753B\u50CF\u3092\u4FDD\u5B58\u3059\u308B\u30D5\u30A9\u30EB\u30C0\u3092\u6307\u5B9A\u3057\u3066\u304F\u3060\u3055\u3044\uFF08Vault\u5185\u306E\u76F8\u5BFE\u30D1\u30B9\uFF09").addText(n=>n.setPlaceholder("\u4F8B: Images/Album Covers").setValue(this.plugin.settings.imageFolderPath).onChange(async i=>{this.plugin.settings.imageFolderPath=i.trim(),await this.plugin.saveSettings()}))}};
